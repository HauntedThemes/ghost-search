/**
 * ghost-search 0.1.0 (https://github.com/HauntedThemes/ghost-search)
 * A simple but powerful search library for Ghost Blogging Platform.
 * Copyright 2018 Haunted Themes (https://www.hauntedthemes.com)
 * Released under MIT License
 * Released on: 17 Sep 2018
 */

function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.fuzzysort=t()}(this,function(){var e="undefined"!=typeof require&&"undefined"==typeof window,t=new Map,r=new Map,n=[];n.total=0;var o=[],i=[];function a(){t.clear(),r.clear(),o=[],i=[]}function l(e){for(var t=-9007199254740991,r=e.length-1;r>=0;--r){var n=e[r];if(null!==n){var o=n.score;o>t&&(t=o)}}return-9007199254740991===t?null:t}function s(e,t){var r=e[t];if(void 0!==r)return r;var n=t;Array.isArray(t)||(n=t.split("."));for(var o=n.length,i=-1;e&&++i<o;)e=e[n[i]];return e}function u(e){return"object"==typeof e}var c=function(){var e=[],t=0,r={};function n(){for(var r=0,n=e[r],o=1;o<t;){var i=o+1;r=o,i<t&&e[i].score<e[o].score&&(r=i),e[r-1>>1]=e[r],o=1+(r<<1)}for(var a=r-1>>1;r>0&&n.score<e[a].score;a=(r=a)-1>>1)e[r]=e[a];e[r]=n}return r.add=function(r){var n=t;e[t++]=r;for(var o=n-1>>1;n>0&&r.score<e[o].score;o=(n=o)-1>>1)e[n]=e[o];e[n]=r},r.poll=function(){if(0!==t){var r=e[0];return e[0]=e[--t],n(),r}},r.peek=function(r){if(0!==t)return e[0]},r.replaceTop=function(t){e[0]=t,n()},r},f=c();return function p(d){var h={single:function(e,t,r){return e?(u(e)||(e=h.getPreparedSearch(e)),t?(u(t)||(t=h.getPrepared(t)),((r&&void 0!==r.allowTypo?r.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo)(e,t,e[0])):null):null},go:function(e,t,r){if(!e)return n;var o=(e=h.prepareSearch(e))[0],i=r&&r.threshold||d&&d.threshold||-9007199254740991,a=r&&r.limit||d&&d.limit||9007199254740991,c=(r&&void 0!==r.allowTypo?r.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo,p=0,g=0,y=t.length;if(r&&r.keys)for(var m=r.scoreFn||l,v=r.keys,b=v.length,k=y-1;k>=0;--k){for(var _=t[k],w=new Array(b),x=b-1;x>=0;--x)(S=s(_,T=v[x]))?(u(S)||(S=h.getPrepared(S)),w[x]=c(e,S,o)):w[x]=null;w.obj=_;var A=m(w);null!==A&&(A<i||(w.score=A,p<a?(f.add(w),++p):(++g,A>f.peek().score&&f.replaceTop(w))))}else if(r&&r.key){var T=r.key;for(k=y-1;k>=0;--k)(S=s(_=t[k],T))&&(u(S)||(S=h.getPrepared(S)),null!==(C=c(e,S,o))&&(C.score<i||(C={target:C.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:C.score,indexes:C.indexes,obj:_},p<a?(f.add(C),++p):(++g,C.score>f.peek().score&&f.replaceTop(C)))))}else for(k=y-1;k>=0;--k){var S,C;(S=t[k])&&(u(S)||(S=h.getPrepared(S)),null!==(C=c(e,S,o))&&(C.score<i||(p<a?(f.add(C),++p):(++g,C.score>f.peek().score&&f.replaceTop(C)))))}if(0===p)return n;var j=new Array(p);for(k=p-1;k>=0;--k)j[k]=f.poll();return j.total=p+g,j},goAsync:function(t,r,o){var i=!1,a=new Promise(function(a,f){if(!t)return a(n);var p=(t=h.prepareSearch(t))[0],g=c(),y=r.length-1,m=o&&o.threshold||d&&d.threshold||-9007199254740991,v=o&&o.limit||d&&d.limit||9007199254740991,b=(o&&void 0!==o.allowTypo?o.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo,k=0,_=0;function w(){if(i)return f("canceled");var c=Date.now();if(o&&o.keys)for(var d=o.scoreFn||l,x=o.keys,A=x.length;y>=0;--y){for(var T=r[y],S=new Array(A),C=A-1;C>=0;--C)(I=s(T,P=x[C]))?(u(I)||(I=h.getPrepared(I)),S[C]=b(t,I,p)):S[C]=null;S.obj=T;var j=d(S);if(null!==j&&!(j<m)&&(S.score=j,k<v?(g.add(S),++k):(++_,j>g.peek().score&&g.replaceTop(S)),y%1e3==0&&Date.now()-c>=10))return void(e?setImmediate(w):setTimeout(w))}else if(o&&o.key){for(var P=o.key;y>=0;--y)if((I=s(T=r[y],P))&&(u(I)||(I=h.getPrepared(I)),null!==(L=b(t,I,p))&&!(L.score<m)&&(L={target:L.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:L.score,indexes:L.indexes,obj:T},k<v?(g.add(L),++k):(++_,L.score>g.peek().score&&g.replaceTop(L)),y%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(w):setTimeout(w))}else for(;y>=0;--y){var I,L;if((I=r[y])&&(u(I)||(I=h.getPrepared(I)),null!==(L=b(t,I,p))&&!(L.score<m)&&(k<v?(g.add(L),++k):(++_,L.score>g.peek().score&&g.replaceTop(L)),y%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(w):setTimeout(w))}if(0===k)return a(n);for(var B=new Array(k),q=k-1;q>=0;--q)B[q]=g.poll();B.total=k+_,a(B)}e?setImmediate(w):w()});return a.cancel=function(){i=!0},a},highlight:function(e,t,r){if(null===e)return null;void 0===t&&(t="<b>"),void 0===r&&(r="</b>");for(var n="",o=0,i=!1,a=e.target,l=a.length,s=e.indexes,u=0;u<l;++u){var c=a[u];if(s[o]===u){if(i||(i=!0,n+=t),++o===s.length){n+=c+r+a.substr(u+1);break}}else i&&(i=!1,n+=r);n+=c}return n},prepare:function(e){if(e)return{target:e,_targetLowerCodes:h.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:h.prepareLowerCodes(e),_nextBeginningIndexes:h.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return h.prepareLowerCodes(e)},getPrepared:function(e){if(e.length>999)return h.prepare(e);var r=t.get(e);return void 0!==r?r:(r=h.prepare(e),t.set(e,r),r)},getPreparedSearch:function(e){if(e.length>999)return h.prepareSearch(e);var t=r.get(e);return void 0!==t?t:(t=h.prepareSearch(e),r.set(e,t),t)},algorithm:function(e,t,r){for(var n=t._targetLowerCodes,a=e.length,l=n.length,s=0,u=0,c=0,f=0;;){if(r===n[u]){if(o[f++]=u,++s===a)break;r=e[0===c?s:c===s?s+1:c===s-1?s-1:s]}if(++u>=l)for(;;){if(s<=1)return null;if(0===c){if(r===e[--s])continue;c=s}else{if(1===c)return null;if((r=e[1+(s=--c)])===e[s])continue}u=o[(f=s)-1]+1;break}}s=0;var p=0,d=!1,g=0,y=t._nextBeginningIndexes;null===y&&(y=t._nextBeginningIndexes=h.prepareNextBeginningIndexes(t.target));var m=u=0===o[0]?0:y[o[0]-1];if(u!==l)for(;;)if(u>=l){if(s<=0){if(++p>a-2)break;if(e[p]===e[p+1])continue;u=m;continue}--s,u=y[i[--g]]}else if(e[0===p?s:p===s?s+1:p===s-1?s-1:s]===n[u]){if(i[g++]=u,++s===a){d=!0;break}++u}else u=y[u];if(d)var v=i,b=g;else v=o,b=f;for(var k=0,_=-1,w=0;w<a;++w)_!==(u=v[w])-1&&(k-=u),_=u;for(d?0!==p&&(k+=-20):(k*=1e3,0!==c&&(k+=-20)),k-=l-a,t.score=k,t.indexes=new Array(b),w=b-1;w>=0;--w)t.indexes[w]=v[w];return t},algorithmNoTypo:function(e,t,r){for(var n=t._targetLowerCodes,a=e.length,l=n.length,s=0,u=0,c=0;;){if(r===n[u]){if(o[c++]=u,++s===a)break;r=e[s]}if(++u>=l)return null}s=0;var f=!1,p=0,d=t._nextBeginningIndexes;if(null===d&&(d=t._nextBeginningIndexes=h.prepareNextBeginningIndexes(t.target)),(u=0===o[0]?0:d[o[0]-1])!==l)for(;;)if(u>=l){if(s<=0)break;--s,u=d[i[--p]]}else if(e[s]===n[u]){if(i[p++]=u,++s===a){f=!0;break}++u}else u=d[u];if(f)var g=i,y=p;else g=o,y=c;for(var m=0,v=-1,b=0;b<a;++b)v!==(u=g[b])-1&&(m-=u),v=u;for(f||(m*=1e3),m-=l-a,t.score=m,t.indexes=new Array(y),b=y-1;b>=0;--b)t.indexes[b]=g[b];return t},prepareLowerCodes:function(e){for(var t=e.length,r=[],n=e.toLowerCase(),o=0;o<t;++o)r[o]=n.charCodeAt(o);return r},prepareBeginningIndexes:function(e){for(var t=e.length,r=[],n=0,o=!1,i=!1,a=0;a<t;++a){var l=e.charCodeAt(a),s=l>=65&&l<=90,u=s||l>=97&&l<=122||l>=48&&l<=57,c=s&&!o||!i||!u;o=s,i=u,c&&(r[n++]=a)}return r},prepareNextBeginningIndexes:function(e){for(var t=e.length,r=h.prepareBeginningIndexes(e),n=[],o=r[0],i=0,a=0;a<t;++a)o>a?n[a]=o:(o=r[++i],n[a]=void 0===o?t:o);return n},cleanup:a,new:p};return h}()});var GhostSearch=function(){function e(t){_classCallCheck(this,e),this.check=!1;var r={input:"#ghost-search-field",results:"#ghost-search-results",button:"",development:!1,template:function(e){return'<a href="'+[location.protocol,"//",location.host].join("")+"/"+e.slug+'/">'+e.title+"</a>"},trigger:"focus",options:{keys:["title"],limit:10,threshold:-3500,allowTypo:!1},api:{resource:"posts",parameters:{limit:"all",fields:["title","slug"],filter:"",include:"",order:"",formats:""}},on:{beforeDisplay:function(){},afterDisplay:function(e){},beforeFetch:function(){},afterFetch:function(e){}}},n=this.mergeDeep(r,t);Object.assign(this,n),this.init()}return _createClass(e,[{key:"mergeDeep",value:function(e,t){var r=this;return e&&"object"===_typeof(e)&&!Array.isArray(e)&&null!==e&&t&&"object"===_typeof(t)&&!Array.isArray(t)&&null!==t&&Object.keys(t).forEach(function(n){t[n]&&"object"===_typeof(t[n])&&!Array.isArray(t[n])&&null!==t[n]?(e[n]||Object.assign(e,_defineProperty({},n,{})),r.mergeDeep(e[n],t[n])):Object.assign(e,_defineProperty({},n,t[n]))}),e}},{key:"url",value:function(){"posts"==this.api.resource&&this.api.parameters.include.match(/(tags|authors)/)&&delete this.api.parameters.fields;var e=ghost.url.api(this.api.resource,this.api.parameters);return e}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this,t=this.url();this.on.beforeFetch(),fetch(t).then(function(e){return e.json()}).then(function(t){return e.search(t)}).catch(function(e){return console.error("Fetch Error =\n",e)})})},{key:"createElementFromHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}},{key:"cleanup",value:function(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")}},{key:"displayResults",value:function(e){if(null!==document.querySelectorAll(this.results)[0].firstChild&&""!==document.querySelectorAll(this.results)[0].firstChild)for(;document.querySelectorAll(this.results)[0].firstChild;)document.querySelectorAll(this.results)[0].removeChild(document.querySelectorAll(this.results)[0].firstChild);var t=document.querySelectorAll(this.input)[0].value,r=fuzzysort.go(t,e,{keys:this.options.keys,limit:this.options.limit,allowTypo:this.options.allowTypo,threshold:this.options.threshold});for(var n in r)n<r.length&&document.querySelectorAll(this.results)[0].appendChild(this.createElementFromHTML(this.template(r[n].obj)));this.on.afterDisplay(r)}},{key:"search",value:function(e){var t=this,r=e[this.api.resource];if(this.on.afterFetch(r),this.check=!0,""!=this.button){var n=document.querySelectorAll(this.button)[0];"INPUT"==n.tagName&&"submit"==n.type&&n.closest("form").addEventListener("submit",function(e){e.preventDefault()}),n.addEventListener("click",function(e){e.preventDefault(),t.on.beforeDisplay(),t.displayResults(r)})}else document.querySelectorAll(this.input)[0].addEventListener("keyup",function(e){t.on.beforeDisplay(),t.displayResults(r)})}},{key:"checkGhostAPI",value:function(){return"undefined"!=typeof ghost||(console.log("Ghost API is not enabled"),!1)}},{key:"checkElements",value:function(){return document.querySelectorAll(this.input).length?document.querySelectorAll(this.results).length?!(""!=this.button&&!document.querySelectorAll(this.button).length)||(console.log("Button not found."),!1):(console.log("Results not found."),!1):(console.log("Input not found."),!1)}},{key:"checkFields",value:function(){var e=[];"posts"==this.api.resource?e=["amp","authors","codeinjection_foot","codeinjection_head","comment_id","created_at","created_by","custom_excerpt","custom_template","feature_image","featured","html","id","locale","meta_description","meta_title","mobiledoc","og_description","og_image","og_title","page","plaintext","primary_author","primary_tag","published_at","published_by","slug","status","tags","title","twitter_description","twitter_image","twitter_title","updated_at","updated_by","url","uuid","visibility"]:"tags"==this.api.resource?e=["count","created_at","created_by","description","feature_image","id","meta_description","meta_title","name","parent","slug","updated_at","updated_by","visibility"]:"users"==this.api.resource&&(e=["accessibility","bio","count","cover_image","facebook","id","locale","location","meta_description","meta_title","name","profile_image","slug","tour","twitter","visibility","website"]);for(var t=0;t<this.api.parameters.fields.length;t++)e.includes(this.api.parameters.fields[t])||console.log("'"+this.api.parameters.fields[t]+"' is not a valid field for "+this.api.resource+". Valid fields for "+this.api.resource+": ['"+e.join("', '")+"']")}},{key:"checkFormats",value:function(){if("posts"==this.api.resource&&this.api.parameters.fields&&"object"===_typeof(this.api.parameters.fields)&&this.api.parameters.fields.constructor===Array)for(var e=0;e<this.api.parameters.fields.length;e++)(!this.api.parameters.formats.includes(this.api.parameters.fields[e])&&this.api.parameters.fields[e].match(/(plaintext|mobiledoc|amp)/)||"html"==this.api.parameters.fields[e]&&this.api.parameters.formats.length>0&&!this.api.parameters.formats.includes("html"))&&console.log(this.api.parameters.fields[e]+" is not included in the formats parameter.")}},{key:"checkKeys",value:function(){var e=this;this.options.keys.every(function(t){return e.api.parameters.fields.indexOf(t)>-1})||console.log("Not all keys are in fields. Please add them.")}},{key:"validate",value:function(){return!(!this.checkGhostAPI()||!this.checkElements())&&(this.development&&(this.checkFields(),this.checkFormats(),this.checkKeys()),!0)}},{key:"init",value:function(){var e=this;this.validate()&&("focus"==this.trigger?document.querySelectorAll(this.input)[0].addEventListener("focus",function(t){e.check||e.fetch()}):"load"==this.trigger&&(window.onload=function(){e.check||e.fetch()}))}}]),e}();
//# sourceMappingURL=ghost-search.min.js.map
