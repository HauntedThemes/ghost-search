/**
 * ghost-search 0.1.1 (https://github.com/HauntedThemes/ghost-search)
 * A simple but powerful search library for Ghost Blogging Platform.
 * Copyright 2018 Haunted Themes (https://www.hauntedthemes.com)
 * Released under MIT License
 * Released on: 29 Nov 2018
 */

function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.fuzzysort=t()}(this,function(){var e="undefined"!=typeof require&&"undefined"==typeof window,t=new Map,r=new Map,i=[];i.total=0;var n=[],o=[];function a(){t.clear(),r.clear(),n=[],o=[]}function l(e){for(var t=-9007199254740991,r=e.length-1;r>=0;--r){var i=e[r];if(null!==i){var n=i.score;n>t&&(t=n)}}return-9007199254740991===t?null:t}function s(e,t){var r=e[t];if(void 0!==r)return r;var i=t;Array.isArray(t)||(i=t.split("."));for(var n=i.length,o=-1;e&&++o<n;)e=e[i[o]];return e}function u(e){return"object"==typeof e}var c=function(){var e=[],t=0,r={};function i(){for(var r=0,i=e[r],n=1;n<t;){var o=n+1;r=n,o<t&&e[o].score<e[n].score&&(r=o),e[r-1>>1]=e[r],n=1+(r<<1)}for(var a=r-1>>1;r>0&&i.score<e[a].score;a=(r=a)-1>>1)e[r]=e[a];e[r]=i}return r.add=function(r){var i=t;e[t++]=r;for(var n=i-1>>1;i>0&&r.score<e[n].score;n=(i=n)-1>>1)e[i]=e[n];e[i]=r},r.poll=function(){if(0!==t){var r=e[0];return e[0]=e[--t],i(),r}},r.peek=function(r){if(0!==t)return e[0]},r.replaceTop=function(t){e[0]=t,i()},r},f=c();return function p(d){var h={single:function(e,t,r){return e?(u(e)||(e=h.getPreparedSearch(e)),t?(u(t)||(t=h.getPrepared(t)),((r&&void 0!==r.allowTypo?r.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo)(e,t,e[0])):null):null},go:function(e,t,r){if(!e)return i;var n=(e=h.prepareSearch(e))[0],o=r&&r.threshold||d&&d.threshold||-9007199254740991,a=r&&r.limit||d&&d.limit||9007199254740991,c=(r&&void 0!==r.allowTypo?r.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo,p=0,g=0,y=t.length;if(r&&r.keys)for(var m=r.scoreFn||l,v=r.keys,b=v.length,k=y-1;k>=0;--k){for(var _=t[k],w=new Array(b),x=b-1;x>=0;--x)(S=s(_,T=v[x]))?(u(S)||(S=h.getPrepared(S)),w[x]=c(e,S,n)):w[x]=null;w.obj=_;var A=m(w);null!==A&&(A<o||(w.score=A,p<a?(f.add(w),++p):(++g,A>f.peek().score&&f.replaceTop(w))))}else if(r&&r.key){var T=r.key;for(k=y-1;k>=0;--k)(S=s(_=t[k],T))&&(u(S)||(S=h.getPrepared(S)),null!==(C=c(e,S,n))&&(C.score<o||(C={target:C.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:C.score,indexes:C.indexes,obj:_},p<a?(f.add(C),++p):(++g,C.score>f.peek().score&&f.replaceTop(C)))))}else for(k=y-1;k>=0;--k){var S,C;(S=t[k])&&(u(S)||(S=h.getPrepared(S)),null!==(C=c(e,S,n))&&(C.score<o||(p<a?(f.add(C),++p):(++g,C.score>f.peek().score&&f.replaceTop(C)))))}if(0===p)return i;var j=new Array(p);for(k=p-1;k>=0;--k)j[k]=f.poll();return j.total=p+g,j},goAsync:function(t,r,n){var o=!1,a=new Promise(function(a,f){if(!t)return a(i);var p=(t=h.prepareSearch(t))[0],g=c(),y=r.length-1,m=n&&n.threshold||d&&d.threshold||-9007199254740991,v=n&&n.limit||d&&d.limit||9007199254740991,b=(n&&void 0!==n.allowTypo?n.allowTypo:!d||void 0===d.allowTypo||d.allowTypo)?h.algorithm:h.algorithmNoTypo,k=0,_=0;function w(){if(o)return f("canceled");var c=Date.now();if(n&&n.keys)for(var d=n.scoreFn||l,x=n.keys,A=x.length;y>=0;--y){for(var T=r[y],S=new Array(A),C=A-1;C>=0;--C)(I=s(T,P=x[C]))?(u(I)||(I=h.getPrepared(I)),S[C]=b(t,I,p)):S[C]=null;S.obj=T;var j=d(S);if(null!==j&&!(j<m)&&(S.score=j,k<v?(g.add(S),++k):(++_,j>g.peek().score&&g.replaceTop(S)),y%1e3==0&&Date.now()-c>=10))return void(e?setImmediate(w):setTimeout(w))}else if(n&&n.key){for(var P=n.key;y>=0;--y)if((I=s(T=r[y],P))&&(u(I)||(I=h.getPrepared(I)),null!==(L=b(t,I,p))&&!(L.score<m)&&(L={target:L.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:L.score,indexes:L.indexes,obj:T},k<v?(g.add(L),++k):(++_,L.score>g.peek().score&&g.replaceTop(L)),y%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(w):setTimeout(w))}else for(;y>=0;--y){var I,L;if((I=r[y])&&(u(I)||(I=h.getPrepared(I)),null!==(L=b(t,I,p))&&!(L.score<m)&&(k<v?(g.add(L),++k):(++_,L.score>g.peek().score&&g.replaceTop(L)),y%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(w):setTimeout(w))}if(0===k)return a(i);for(var q=new Array(k),B=k-1;B>=0;--B)q[B]=g.poll();q.total=k+_,a(q)}e?setImmediate(w):w()});return a.cancel=function(){o=!0},a},highlight:function(e,t,r){if(null===e)return null;void 0===t&&(t="<b>"),void 0===r&&(r="</b>");for(var i="",n=0,o=!1,a=e.target,l=a.length,s=e.indexes,u=0;u<l;++u){var c=a[u];if(s[n]===u){if(o||(o=!0,i+=t),++n===s.length){i+=c+r+a.substr(u+1);break}}else o&&(o=!1,i+=r);i+=c}return i},prepare:function(e){if(e)return{target:e,_targetLowerCodes:h.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:h.prepareLowerCodes(e),_nextBeginningIndexes:h.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return h.prepareLowerCodes(e)},getPrepared:function(e){if(e.length>999)return h.prepare(e);var r=t.get(e);return void 0!==r?r:(r=h.prepare(e),t.set(e,r),r)},getPreparedSearch:function(e){if(e.length>999)return h.prepareSearch(e);var t=r.get(e);return void 0!==t?t:(t=h.prepareSearch(e),r.set(e,t),t)},algorithm:function(e,t,r){for(var i=t._targetLowerCodes,a=e.length,l=i.length,s=0,u=0,c=0,f=0;;){if(r===i[u]){if(n[f++]=u,++s===a)break;r=e[0===c?s:c===s?s+1:c===s-1?s-1:s]}if(++u>=l)for(;;){if(s<=1)return null;if(0===c){if(r===e[--s])continue;c=s}else{if(1===c)return null;if((r=e[1+(s=--c)])===e[s])continue}u=n[(f=s)-1]+1;break}}s=0;var p=0,d=!1,g=0,y=t._nextBeginningIndexes;null===y&&(y=t._nextBeginningIndexes=h.prepareNextBeginningIndexes(t.target));var m=u=0===n[0]?0:y[n[0]-1];if(u!==l)for(;;)if(u>=l){if(s<=0){if(++p>a-2)break;if(e[p]===e[p+1])continue;u=m;continue}--s,u=y[o[--g]]}else if(e[0===p?s:p===s?s+1:p===s-1?s-1:s]===i[u]){if(o[g++]=u,++s===a){d=!0;break}++u}else u=y[u];if(d)var v=o,b=g;else v=n,b=f;for(var k=0,_=-1,w=0;w<a;++w)_!==(u=v[w])-1&&(k-=u),_=u;for(d?0!==p&&(k+=-20):(k*=1e3,0!==c&&(k+=-20)),k-=l-a,t.score=k,t.indexes=new Array(b),w=b-1;w>=0;--w)t.indexes[w]=v[w];return t},algorithmNoTypo:function(e,t,r){for(var i=t._targetLowerCodes,a=e.length,l=i.length,s=0,u=0,c=0;;){if(r===i[u]){if(n[c++]=u,++s===a)break;r=e[s]}if(++u>=l)return null}s=0;var f=!1,p=0,d=t._nextBeginningIndexes;if(null===d&&(d=t._nextBeginningIndexes=h.prepareNextBeginningIndexes(t.target)),(u=0===n[0]?0:d[n[0]-1])!==l)for(;;)if(u>=l){if(s<=0)break;--s,u=d[o[--p]]}else if(e[s]===i[u]){if(o[p++]=u,++s===a){f=!0;break}++u}else u=d[u];if(f)var g=o,y=p;else g=n,y=c;for(var m=0,v=-1,b=0;b<a;++b)v!==(u=g[b])-1&&(m-=u),v=u;for(f||(m*=1e3),m-=l-a,t.score=m,t.indexes=new Array(y),b=y-1;b>=0;--b)t.indexes[b]=g[b];return t},prepareLowerCodes:function(e){for(var t=e.length,r=[],i=e.toLowerCase(),n=0;n<t;++n)r[n]=i.charCodeAt(n);return r},prepareBeginningIndexes:function(e){for(var t=e.length,r=[],i=0,n=!1,o=!1,a=0;a<t;++a){var l=e.charCodeAt(a),s=l>=65&&l<=90,u=s||l>=97&&l<=122||l>=48&&l<=57,c=s&&!n||!o||!u;n=s,o=u,c&&(r[i++]=a)}return r},prepareNextBeginningIndexes:function(e){for(var t=e.length,r=h.prepareBeginningIndexes(e),i=[],n=r[0],o=0,a=0;a<t;++a)n>a?i[a]=n:(n=r[++o],i[a]=void 0===n?t:n);return i},cleanup:a,new:p};return h}()});var GhostSearch=function(){function e(t){_classCallCheck(this,e),this.check=!1;var r={input:"#ghost-search-field",results:"#ghost-search-results",button:"",development:!1,defaultValue:"",template:function(e){return'<a href="'+[location.protocol,"//",location.host].join("")+"/"+e.slug+'/">'+e.title+"</a>"},trigger:"focus",options:{keys:["title"],limit:10,threshold:-3500,allowTypo:!1},api:{resource:"posts",parameters:{limit:"all",fields:["title","slug"],filter:"",include:"",order:"",formats:""}},on:{beforeDisplay:function(){},afterDisplay:function(e){},beforeFetch:function(){},afterFetch:function(e){}}},i=this.mergeDeep(r,t);Object.assign(this,i),this.init()}return _createClass(e,[{key:"mergeDeep",value:function(e,t){var r=this;return e&&"object"===_typeof(e)&&!Array.isArray(e)&&null!==e&&t&&"object"===_typeof(t)&&!Array.isArray(t)&&null!==t&&Object.keys(t).forEach(function(i){t[i]&&"object"===_typeof(t[i])&&!Array.isArray(t[i])&&null!==t[i]?(e[i]||Object.assign(e,_defineProperty({},i,{})),r.mergeDeep(e[i],t[i])):Object.assign(e,_defineProperty({},i,t[i]))}),e}},{key:"url",value:function(){"posts"==this.api.resource&&this.api.parameters.include.match(/(tags|authors)/)&&delete this.api.parameters.fields;var e=ghost.url.api(this.api.resource,this.api.parameters);return e}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this,t=this.url();this.on.beforeFetch(),fetch(t).then(function(e){return e.json()}).then(function(t){return e.search(t)}).catch(function(e){return console.error("Fetch Error =\n",e)})})},{key:"createElementFromHTML",value:function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}},{key:"cleanup",value:function(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")}},{key:"displayResults",value:function(e){if(null!==document.querySelectorAll(this.results)[0].firstChild&&""!==document.querySelectorAll(this.results)[0].firstChild)for(;document.querySelectorAll(this.results)[0].firstChild;)document.querySelectorAll(this.results)[0].removeChild(document.querySelectorAll(this.results)[0].firstChild);var t=document.querySelectorAll(this.input)[0].value;""!=this.defaultValue&&(t=this.defaultValue);var r=fuzzysort.go(t,e,{keys:this.options.keys,limit:this.options.limit,allowTypo:this.options.allowTypo,threshold:this.options.threshold});for(var i in r)i<r.length&&document.querySelectorAll(this.results)[0].appendChild(this.createElementFromHTML(this.template(r[i].obj)));this.on.afterDisplay(r),this.defaultValue=""}},{key:"search",value:function(e){var t=this,r=e[this.api.resource];if(this.on.afterFetch(r),this.check=!0,""!=this.defaultValue&&(this.on.beforeDisplay(),this.displayResults(r)),""!=this.button){var i=document.querySelectorAll(this.button)[0];"INPUT"==i.tagName&&"submit"==i.type&&i.closest("form").addEventListener("submit",function(e){e.preventDefault()}),i.addEventListener("click",function(e){e.preventDefault(),t.on.beforeDisplay(),t.displayResults(r)})}else document.querySelectorAll(this.input)[0].addEventListener("keyup",function(e){t.on.beforeDisplay(),t.displayResults(r)})}},{key:"checkGhostAPI",value:function(){return"undefined"!=typeof ghost||(console.log("Ghost API is not enabled"),!1)}},{key:"checkElements",value:function(){return document.querySelectorAll(this.input).length?document.querySelectorAll(this.results).length?!(""!=this.button&&!document.querySelectorAll(this.button).length)||(console.log("Button not found."),!1):(console.log("Results not found."),!1):(console.log("Input not found."),!1)}},{key:"checkFields",value:function(){var e=[];"posts"==this.api.resource?e=["amp","authors","codeinjection_foot","codeinjection_head","comment_id","created_at","created_by","custom_excerpt","custom_template","feature_image","featured","html","id","locale","meta_description","meta_title","mobiledoc","og_description","og_image","og_title","page","plaintext","primary_author","primary_tag","published_at","published_by","slug","status","tags","title","twitter_description","twitter_image","twitter_title","updated_at","updated_by","url","uuid","visibility"]:"tags"==this.api.resource?e=["count","created_at","created_by","description","feature_image","id","meta_description","meta_title","name","parent","slug","updated_at","updated_by","visibility"]:"users"==this.api.resource&&(e=["accessibility","bio","count","cover_image","facebook","id","locale","location","meta_description","meta_title","name","profile_image","slug","tour","twitter","visibility","website"]);for(var t=0;t<this.api.parameters.fields.length;t++)e.includes(this.api.parameters.fields[t])||console.log("'"+this.api.parameters.fields[t]+"' is not a valid field for "+this.api.resource+". Valid fields for "+this.api.resource+": ['"+e.join("', '")+"']")}},{key:"checkFormats",value:function(){if("posts"==this.api.resource&&this.api.parameters.fields&&"object"===_typeof(this.api.parameters.fields)&&this.api.parameters.fields.constructor===Array)for(var e=0;e<this.api.parameters.fields.length;e++)(!this.api.parameters.formats.includes(this.api.parameters.fields[e])&&this.api.parameters.fields[e].match(/(plaintext|mobiledoc|amp)/)||"html"==this.api.parameters.fields[e]&&this.api.parameters.formats.length>0&&!this.api.parameters.formats.includes("html"))&&console.log(this.api.parameters.fields[e]+" is not included in the formats parameter.")}},{key:"checkKeys",value:function(){var e=this;this.options.keys.every(function(t){return e.api.parameters.fields.indexOf(t)>-1})||console.log("Not all keys are in fields. Please add them.")}},{key:"validate",value:function(){return!(!this.checkGhostAPI()||!this.checkElements())&&(this.development&&(this.checkFields(),this.checkFormats(),this.checkKeys()),!0)}},{key:"init",value:function(){var e=this;this.validate()&&(""!=this.defaultValue&&(document.querySelectorAll(this.input)[0].value=this.defaultValue,window.onload=function(){e.check||e.fetch()}),"focus"==this.trigger?document.querySelectorAll(this.input)[0].addEventListener("focus",function(t){e.check||e.fetch()}):"load"==this.trigger&&(window.onload=function(){e.check||e.fetch()}))}}]),e}();
//# sourceMappingURL=ghost-search.min.js.map
